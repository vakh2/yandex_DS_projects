# 10. Временные ряды

### Цели проекта

- Спрогнозировать количество заказов такси на следующий час.  
- Построить модель для такого предсказания.  
- Значение метрики RMSE на тестовой выборке должно быть не больше 48.  

### Задачи проекта

- Загрузить данные и выполнить их ресемплирование по одному часу.
- Проанализировать данные.
- Обучить разные модели с различными гиперпараметрами. 
- Сделайть тестовую выборку размером 10% от исходных данных.
- Проверить данные на тестовой выборке.
- Сделать выводы.

### Итоги

* __Нами были получены исторические данные о заказах такси в аэропортах. Необходимо было исследовать временной ряд и обучить модель для предсказания количество заказов такси на следующий час.__
* __Загрузили и посмотрели внешний вид и изучили общую информацию о данных при этом:__
  * Изменили тип данных Datetime с object на datetime64 и установили индекс таблицы равным столбцу Datetime.
  * Провели сортировку по индексу и ресемплирование по часу с агрегацией по сумме. 
* __Посмотрим на возможные аномалии:__
  * Распределение нормальное.
  * Минимальные (0 - 5) значения вполне реальны в под утренние часы, когда еще все люди спят и на предприятиях еще не закончились ночные смены. 
  * Максимальные (300 - 462) могут возникнуть как в ночное время по причине неработающего общественного транспорта, так и по погодным условиям (сильный дождь или снег). 
  * Аномалий нет.
* __Исследовали временной ряд:__
  * Метод seasonal_decompose показал наличие тренда, сезонности и шума во временном ряду.
  * По графикам четко видно наличие дневной с привязкой по часам и недельной сезонности с привязкой по дням недели и отсутствия месячной сезонности с привязкой по дням месяца.
  * Годовую сезонность определить невозможно в связи с ограниченным в полгода временным рядом.
  * Для проверки стационарности провели обобщенный тест Дикки-Фуллера на наличие единичных корней, который показал, что гипотеза о стационарности не отвергается.
  * Тест KPSS опроверг гипотезу о стационарности на константу и гипотезу о тренд-стационарности.
  * Разные результаты тестов возникли из-за разных подходов в тестах.
  * Исходя из этого точно утверждать что временной ряд является нестационарным нельзя, возможно он "слишком близок" к стационарному или вообще стационарный, а тесты путают тренд с какой-то цикличностью на  много большем временном промежутке чем сам ряд.
  * В связи с тем, что нестационарные временные ряды дают большую неточность прогнозирования необходимо привести нестационарный временной ряд к стационарному. Но наш ряд если нестационарный, то близок к стационарному, поэтому проведем обучение на нем.
* __Обучили модель, для этого:__
  * Написали функции для создадим признаков для обучения которая добавляет столбцы с днями недели и часами, а также столбцы с разностью последовательности значений и среднего по окну с удалением первых сток содержащих NaN
  * Написали функцию нахождения значения метрики RMSE
  * Написали функцию подбора гиперпераметров для модели методом GridSearch с кросс-валидацией (cv=4) по обучающей выборке, с обращением к функции подбора оптимального количества признаков и фиксацией времени обучения и предсказания.
  * Обучили модели 'DecisionTreeRegressor', 'RandomForestRegressor', 'CatBoostRegressor', 'LightGBMRegressor'. 
  * Лучшее значение RMSE = 9 на обучающей выборке показала модель RandomForestRegressor, но при этом самое большее время обучения.
  * Недалеко позади со значением RMSE = 11.3	на обучающей выборке показала модель LightGBMRegressor, но при этом время обучения в два раза быстрее чем RandomForestRegressor.
  * Худшие значения RMSE на обучающей выборке показали модели DecisionTreeRegressor и CatBoostRegressor
  * Для дальнего тестирования выбираем модель RandomForestRegressor по причине лучшего RMSE на обучающей выборке. В том случае если скорость обучения имеет большое значения можно выбрать модель LightGBMRegressor. 
* __Значение метрики RMSE на тестовой выборке: 42.8. Значение меньше 48. Тестирование прошло успешно.__
* __Визуализация сравнения фактических значений и предсказанных значений показывает неплохие результаты. Модель предсказания сглаживает локальные максимумы и минимумы оставаясь в рамках сезонности.__
* __Модель можно рекомндовать для предсказания количество заказов такси на следующий час.__

### Используемый стек инструментов

- python
- pandas
- numpy
- sklearn
- statsmodels
- matplotlib
- seaborn
- catboost
- lightgbm
- copy
- timeit
- warnings
- datetime
